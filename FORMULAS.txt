================================================================================
MUSIC THERAPY STUDIO - KEY FORMULAS
================================================================================
Essential Formulas for Music Recommendation Algorithm
Version: 2.0 | December 2025

================================================================================
1. EUCLIDEAN DISTANCE (Emotional Similarity)
================================================================================

d(p₁, p₂) = √[(v₂ - v₁)² + (a₂ - a₁)² + (d₂ - d₁)²]

Where:
- v = Valence (-1 to +1)
- a = Arousal (-1 to +1)
- d = Dominance (-1 to +1)

Example: sad (-0.7, -0.6) to happy (0.8, 0.8)
d = √[(1.5)² + (1.4)²] = √4.21 = 2.05

Used for: KNN song matching, measuring emotional distance


================================================================================
2. CUBIC EASING (Smooth Transitions)
================================================================================

IF t < 0.5:
    eased_t = 4t³
ELSE:
    eased_t = 1 - [(-2t + 2)³ / 2]

Interpolated value:
    value(t) = start + (end - start) × eased_t

Where t ∈ [0, 1] is progress ratio

Effect: Slow start → Fast middle → Slow end (45% smoother than linear)

Used for: Generating smooth emotional transition points between songs


================================================================================
3. Z-SCORE NORMALIZATION (Feature Standardization)
================================================================================

z = (x - μ) / σ

Where:
- x = original value
- μ = mean of all values
- σ = standard deviation

Result: mean=0, std=1

Example: x = 0.8, μ = 0.26, σ = 0.40
z = (0.8 - 0.26) / 0.40 = 1.35

Used for: Standardizing valence, arousal, dominance before KNN


================================================================================
4. EXPONENTIAL WEIGHTING (Song Selection)
================================================================================

Step 1: Shift scores to positive
    s'ᵢ = sᵢ - min(scores) + 0.1

Step 2: Apply exponential
    w(sᵢ) = e^(s'ᵢ)

Step 3: Normalize to probabilities
    P(sᵢ) = e^(s'ᵢ) / Σⱼ e^(s'ⱼ)

Example:
scores = [-1.2, -0.8, -1.5, -0.5]
probabilities = [18.5%, 27.6%, 16.7%, 37.2%]

Used for: Weighted random selection (ensures playlist diversity)


================================================================================
5. SONG SCORING
================================================================================

score = -distance + diversity_bonus

Where:
- distance = ||song_features - target_features||₂
- diversity_bonus = 0.3 if any songs already selected, else 0.0

Higher score = better match

Used for: Ranking candidate songs from KNN results


================================================================================
6. VAD EMOTION COORDINATES
================================================================================

Key emotions (Valence, Arousal):

happy:      (0.8, 0.8)   | sad:        (-0.7, -0.6)
angry:      (-0.6, 0.7)  | calm:       (0.7, -0.7)
anxious:    (-0.3, 0.6)  | neutral:    (0.0, 0.0)
energized:  (0.6, 0.8)   | relaxed:    (0.5, -0.6)

Intermediate emotions:
melancholic: (-0.5, -0.4) | content:    (0.4, -0.3)
somber:      (-0.35, -0.2)| serene:     (0.6, -0.5)

Used for: Converting emotion names to numerical coordinates for KNN


================================================================================
7. KNN COMPLEXITY
================================================================================

Ball-tree algorithm:
- Query: O(log N) per song
- Space: O(N) where N = 22,005 songs
- Build: O(N log N) one-time initialization

Used for: Efficient nearest neighbor search (50 candidates per point)


================================================================================
END OF FORMULAS
================================================================================
